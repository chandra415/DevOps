# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger: none

pool:
  vmImage: windows-latest

schedules:
  - cron: "*/2 * * * *"
    displayName: QA7
    branches:
      include:
        - master
variables:
#   endpointUrl: "https://dev.azure.com/{organization}/{project}/_apis/build/builds/{buildId}?api-version=6.1-preview.7"
#   organization: "sunrise7"
#   project: "FirstPractise"
  buildId: $(Build.BuildId)
  
steps:
- script: echo Hello, world!
  displayName: 'Run a one-line script'

- script: |
    echo Add other tasks to build, test, and deploy your project.
    echo See https://aka.ms/yaml
  displayName: 'Run a multi-line script'

- task: PowerShell@1
  inputs:
    scriptType: 'inlineScript'
    inlineScript: |
            $url = "https://dev.azure.com/sunrise7/FirstPractise/_apis/build/builds/{buildId}?api-version=6.1-preview.7"
            $organization = "sunrise7"
            $project = "FirstPractise"
            $buildId = "${{variables.buildId}}"
      
            $response = Invoke-RestMethod -Uri $url -Method Get -ContentType "application/json" -Headers @{Authorization=("Bearer {0}" -f $env:SYSTEM_ACCESSTOKEN)}
      
            $scheduleName = $response.triggerInfo.scheduleName
      
            Write-Host "The trigger schedule name is: $scheduleName"